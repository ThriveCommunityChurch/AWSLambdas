# Test case: "Loneliness" - Emotional topic referencing Surgeon General's 2023 loneliness epidemic report
# Speaker: John Roth
# This tests the model's ability to handle pastoral/counseling content
- vars:
    title: "Loneliness"
    speaker: "John Roth"
    date: "2023-12-10"
    transcript: |
      You are listening to a message from Thrive Community Church, a church located in Southwest Florida. For more info, visit us at thrive-fl.org. Lord God, we thank you for this day. We thank you for the opportunity to gather together. We thank you for your presence with us. And we pray, Lord God, that you would bless this time together. We pray that your word would be over us, your truth would be in us, your peace would be upon us. And we pray, Lord God, that you would work through this message to give us the courage to trust you always, to live according to your promises, to walk out into this world and be up to the calling you've given us. All this we lift up to you in Jesus' name. Amen. So I want to talk about something today that I think is one of the most pressing issues of our time. And that is loneliness. In May of 2023, the Surgeon General of the United States, Dr. Vivek Murthy, issued an advisory declaring loneliness and isolation to be an epidemic in America. He said that loneliness is as dangerous to our health as smoking 15 cigarettes a day. He said that loneliness increases the risk of heart disease by 29%, the risk of stroke by 32%, and the risk of dementia by 50%. He said that loneliness is associated with higher rates of depression, anxiety, and suicide. And he said that loneliness is not just a personal problem, but a public health crisis. Now, you might think that loneliness is something that only affects certain people. Maybe the elderly. Maybe those who live alone. Maybe those who are socially awkward. But the research shows that loneliness affects everyone. In fact, the research shows that young people are actually more lonely than older people. One study found that 61% of young adults reported feeling lonely. Another study found that the average American has only one close friend, down from three close friends in 1985. We are more connected than ever through technology, and yet we are more lonely than ever. We have hundreds of friends on social media, and yet we feel like we have no one to talk to. We are surrounded by people, and yet we feel alone. So what's going on? Why are we so lonely? I think there are a few reasons. First, we are busier than ever. We work longer hours. We have more commitments. We have more activities. We have more screens competing for our attention. And in the midst of all that busyness, we don't have time for deep relationships. We don't have time to sit with a friend and just talk. We don't have time to be present with someone. We're always rushing to the next thing. Second, we are more mobile than ever. We move for jobs. We move for school. We move for family. We move for opportunity. And every time we move, we leave behind relationships. We leave behind community. We leave behind the people who know us and love us. And we have to start over. And starting over is hard. Building new relationships takes time and effort. And so we end up with a lot of acquaintances but few deep friendships. Third, we are more individualistic than ever. Our culture tells us that we don't need anyone. Our culture tells us that we should be self-sufficient. Our culture tells us that asking for help is a sign of weakness. And so we try to do everything on our own. We try to handle our problems on our own. We try to carry our burdens on our own. And we end up isolated and alone. Fourth, we are more afraid than ever. We are afraid of being rejected. We are afraid of being judged. We are afraid of being hurt. And so we put up walls. We keep people at a distance. We don't let anyone get too close. Because if they get too close, they might see the real us. And if they see the real us, they might not like what they see. And so we hide. We pretend. We wear masks. And we end up lonely. Now, here's the thing. God did not create us to be alone. In the very beginning, in the Garden of Eden, God said, It is not good for man to be alone. That's the first time in the Bible that God says something is not good. Everything else God created, he said it was good. But when he saw Adam alone, he said, That's not good. And so he created Eve. He created community. He created relationship. Because we were made for connection. We were made for relationship. We were made for community. And when we don't have that, something is wrong. Something is missing. Something is not good. So what do we do about loneliness? Well, I think the first thing we need to do is acknowledge it. We need to admit that we are lonely. We need to stop pretending that everything is fine. We need to stop putting on a brave face. We need to be honest with ourselves and with others about how we are really doing. Because you can't address a problem that you won't acknowledge. The second thing we need to do is reach out. We need to take the initiative to connect with others. We need to invite someone to coffee. We need to join a small group. We need to volunteer somewhere. We need to show up. Because relationships don't just happen. They take effort. They take intentionality. They take risk. And yes, it's scary. Yes, you might get rejected. Yes, you might get hurt. But the alternative is worse. The alternative is loneliness. The third thing we need to do is be present. We need to put down our phones. We need to turn off our screens. We need to look people in the eye. We need to listen. We need to be fully present with the people in front of us. Because you can't have a deep relationship with someone if you're always distracted. You can't connect with someone if you're always looking at your phone. You can't know someone if you're not paying attention. The fourth thing we need to do is be vulnerable. We need to let people in. We need to share our struggles. We need to admit our weaknesses. We need to take off our masks. Because you can't have a deep relationship with someone if they don't know the real you. You can't be truly known if you're always hiding. You can't be truly loved if you're always pretending. And yes, vulnerability is scary. Yes, you might get hurt. But the alternative is worse. The alternative is loneliness. The fifth thing we need to do is trust God. Because ultimately, our deepest loneliness can only be satisfied by God. Augustine said, Our hearts are restless until they find their rest in you. We were made for relationship with God. And when we don't have that relationship, we will always feel a sense of loneliness, no matter how many friends we have. So we need to cultivate our relationship with God. We need to spend time with him in prayer. We need to read his word. We need to worship him. We need to trust him. Because he is the one who will never leave us or forsake us. He is the one who is always with us. He is the one who knows us fully and loves us completely. And when we have that relationship with God, we can face the loneliness of this world. We can reach out to others. We can be vulnerable. We can take risks. Because we know that even if everyone else abandons us, God never will. Let me close with this. If you are lonely today, I want you to know that you are not alone. God is with you. And this church is here for you. We want to know you. We want to walk with you. We want to be in community with you. So don't suffer in silence. Reach out. Connect. Be present. Be vulnerable. And trust God. Because he has something better for you than loneliness. He has community. He has relationship. He has love. Let's pray. Lord God, we thank you that you are with us. We thank you that you never leave us or forsake us. We thank you that you know us fully and love us completely. Lord, we confess that we are often lonely. We confess that we have put up walls. We confess that we have been afraid to let people in. Forgive us, Lord. Help us to reach out. Help us to be present. Help us to be vulnerable. Help us to trust you. And help us to find the community and relationship that you have for us. All this we pray in Jesus' name. Amen.
  assert:
    # ACCURACY VALIDATIONS
    - type: javascript
      value: |
        // Verify quotes appear in transcript (fuzzy match - at least 60% of words)
        const json = typeof output === 'string' ? JSON.parse(output) : output;
        const transcript = context.vars.transcript.toLowerCase();
        const quotes = json.quotes || [];
        if (quotes.length === 0) return true;

        function wordOverlap(quote, text) {
          const quoteWords = quote.toLowerCase().replace(/[^\w\s]/g, '').split(/\s+/).filter(w => w.length > 3);
          if (quoteWords.length === 0) return 1;
          const matchCount = quoteWords.filter(w => text.includes(w)).length;
          return matchCount / quoteWords.length;
        }

        const failed = quotes.filter(q => wordOverlap(q.text, transcript) < 0.6);
        return failed.length === 0;
    - type: javascript
      value: |
        // Verify scripture references were mentioned in transcript (with word-to-number normalization)
        const json = typeof output === 'string' ? JSON.parse(output) : output;
        const transcript = context.vars.transcript.toLowerCase();

        // Number word mappings
        const ordinals = {first:'1',second:'2',third:'3',fourth:'4',fifth:'5',sixth:'6',seventh:'7',eighth:'8',ninth:'9',tenth:'10',eleventh:'11',twelfth:'12',thirteenth:'13',fourteenth:'14',fifteenth:'15',sixteenth:'16',seventeenth:'17',eighteenth:'18',nineteenth:'19',twentieth:'20',twentyfirst:'21',twentysecond:'22',twentythird:'23',twentyfourth:'24',twentyfifth:'25',twentysixth:'26',twentyseventh:'27',twentyeighth:'28',twentyninth:'29',thirtieth:'30',thirtyfirst:'31'};
        const cardinals = {one:'1',two:'2',three:'3',four:'4',five:'5',six:'6',seven:'7',eight:'8',nine:'9',ten:'10',eleven:'11',twelve:'12',thirteen:'13',fourteen:'14',fifteen:'15',sixteen:'16',seventeen:'17',eighteen:'18',nineteen:'19',twenty:'20',twentyone:'21',twentytwo:'22',twentythree:'23',twentyfour:'24',twentyfive:'25',twentysix:'26',twentyseven:'27',twentyeight:'28',twentynine:'29',thirty:'30',thirtyone:'31',thirtytwo:'32',thirtythree:'33',thirtyfour:'34',thirtyfive:'35',thirtysix:'36',thirtyseven:'37',thirtyeight:'38',thirtynine:'39',forty:'40',fortyone:'41',fortytwo:'42',fortythree:'43',fortyfour:'44',fortyfive:'45',fortysix:'46',fortyseven:'47',fortyeight:'48',fortynine:'49',fifty:'50',fiftyone:'51',fiftytwo:'52',fiftythree:'53',fiftyfour:'54',fiftyfive:'55',fiftysix:'56',fiftyseven:'57',fiftyeight:'58',fiftynine:'59',sixty:'60',sixtyone:'61',sixtytwo:'62',sixtythree:'63',sixtyfour:'64',sixtyfive:'65',sixtysix:'66',sixtyseven:'67',sixtyeight:'68',sixtynine:'69',seventy:'70',seventyone:'71',seventytwo:'72',seventythree:'73',seventyfour:'74',seventyfive:'75',seventysix:'76',seventyseven:'77',seventyeight:'78',seventynine:'79',eighty:'80',eightyone:'81',eightytwo:'82',eightythree:'83',eightyfour:'84',eightyfive:'85',eightysix:'86',eightyseven:'87',eightyeight:'88',eightynine:'89',ninety:'90',ninetyone:'91',ninetytwo:'92',ninetythree:'93',ninetyfour:'94',ninetyfive:'95',ninetysix:'96',ninetyseven:'97',ninetyeight:'98',ninetynine:'99',onehundred:'100',hundred:'100'};
        const books = ['genesis','exodus','leviticus','numbers','deuteronomy','joshua','judges','ruth','samuel','kings','chronicles','ezra','nehemiah','esther','job','psalm','psalms','proverbs','ecclesiastes','song of solomon','isaiah','jeremiah','lamentations','ezekiel','daniel','hosea','joel','amos','obadiah','jonah','micah','nahum','habakkuk','zephaniah','haggai','zechariah','malachi','matthew','mark','luke','john','acts','romans','corinthians','galatians','ephesians','philippians','colossians','thessalonians','timothy','titus','philemon','hebrews','james','peter','jude','revelation'];

        function normalize(text) {
          let t = text.toLowerCase().replace(/[-]/g, ' ');
          // Ordinals for book prefixes (first john -> 1 john)
          for (const [word, num] of Object.entries(ordinals)) {
            t = t.replace(new RegExp('\\b' + word + '\\b', 'g'), num);
          }
          // Cardinals for chapters/verses
          for (const [word, num] of Object.entries(cardinals)) {
            t = t.replace(new RegExp('\\b' + word + '\\b', 'g'), num);
          }
          return t;
        }

        const normTranscript = normalize(transcript);
        const scriptures = [];
        if (json.mainScripture) scriptures.push(json.mainScripture);
        (json.keyPoints || []).forEach(kp => { if (kp.scripture) scriptures.push(kp.scripture); });

        const failed = scriptures.filter(ref => {
          if (!ref || ref.trim() === '') return false;
          const normRef = normalize(ref);
          const bookMatch = normRef.match(/^(\d?\s*[a-z]+)/);
          if (!bookMatch) return false;
          const book = bookMatch[1].replace(/\s+/g, ' ').trim();
          return !normTranscript.includes(book);
        });

        return failed.length === 0;

