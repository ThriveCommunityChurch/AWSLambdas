# Test case: "Peace" - Guest speaker sermon on Mark 5, Hebrew word study on Shalom
# Speaker: Todd Tuggle (guest speaker filling in for Pastor Roth)
# This tests the model's ability to handle guest speakers and word study sermons
- vars:
    title: "Peace"
    speaker: "Todd Tuggle"
    date: "2025-01-05"
    transcript: |
      You are listening to a message from Thrive Community Church, a church located in Southwest Florida. For more info, visit us at thrive-fl.org Those of you that maybe I have not yet met, my name is Todd, and I think this is the third time I've been up here and it's a privilege and an honor to be back, to be invited back, to fill in for John while he's away, and to give him a break. And before I get started, I just want to say again, thank you to all of you here at Thrive for embracing Jennifer and I during a kind of a tough time in our lives as she's been going through treatment at Moffitt, and you have wrapped your arms around us, you have shown us Jesus' love in ways that we would have never expected. And so thank you, well done you, and we are thrilled to be a part of it, and I'm thrilled to be able to share something with you this morning. And I hope to do more teaching today than preaching, because what I want to share with you is one of those episodes in Jesus' life that I think we very easily move past and go on to the next one without really stopping and seeing what's going on if you know the background. So we're going to be in Mark chapter 5 this morning, and the context of this before we read it is that Jesus has just returned from the Gentile region across the Sea of Galilee. He's returned from the Gentile region over back into the Jewish land of Galilee, and he is on his way to the house of a synagogue ruler named Jarius, and Jarius' daughter is about to die. And so he's gone to Jesus and said, you've got to come to my house. On the way, this is what happens. And we'll see how Jesus deals with interruptions as he's on his way somewhere. Mark chapter 5, starting at verse 24. And a great crowd followed him and thronged about him. And there was a woman who had had a discharge of blood for 12 years, and who had suffered much under many physicians, and had spent all that she had, and was no better, but rather grew worse. She had heard the reports about Jesus, and came up behind him in the crowd, and touched his garments. For she said, if I touch even his garments, I will be made well. And immediately the flow of blood dried up, and she felt in her body that she was healed of her disease. Now as I said, it would be easy for us to maybe read this as you're going through your daily Bible reading, and then just go on to the next story, and what happened with Jarius's daughter, and all of that, and kind of just skip over this. But we have to remember that Jesus was a Jewish rabbi. He was living in a Jewish region with Jewish people, calling people back to a Jewish God. And we can either skim over this, or sometimes we grab a few lines of this and this, and drop them into our culture, without first stepping into theirs. And that's what I want to do this morning, is I want to step into their culture, so that maybe these words actually become a little more alive. Let's go back to verse 25. And there was a woman who had had a discharge of blood for 12 years. Ladies, can you imagine? I mean, just physically, can you imagine the torment that she's gone through? But you also have to understand what that meant for her socially and culturally. Let me read for you what that meant. This is from Leviticus chapter 15. This is God speaking through Moses to tell the children of Israel what to do and how to live. If a woman has a discharge of blood for many days, not at the time of her menstrual impurity, or if she has a discharge beyond the time of her impurity, all the days of the discharge she shall continue in uncleanness. As in the days of her impurity, she shall be unclean. Every bed on which she lies all the days of her discharge shall be to her as the bed of her impurity. And everything on which she sits shall be unclean. So first of all, she's considered unclean. She could touch no one, and no one could touch her. So she's totally isolated. And everything that she touched became unclean. So therefore that meant that she was unable to worship in the synagogue. She couldn't shop. She couldn't go to the well for water. She was then completely dependent on other people. So for 12 years she's been isolated, empty, desperate, broken, in misery, and dependent. And it affected every area of her life. So she comes to Jesus as a last resort. All her efforts, all her wisdom, all her prayers, all her money hadn't worked. Not much of a life, I think you would agree. Not only that, but look at verse 26. It says, and she had suffered much under many physicians and spent all that she had and was no better but rather grew worse. Then what happens? Verse 27. She had heard the reports about Jesus and came up behind him in the crowd and touched his garment. For she said, even if I touch even his garments, I will be made well. Now this opinion of what she's thinking came from her knowledge of something in the book of Numbers. This is Numbers chapter 15. The Lord said to Moses, speak to the people of Israel and tell them to make tassels on the corners of their garments throughout their generations and to put a cord of blue on the tassel of each corner and it shall be a tassel for you to look at and remember all the commandments of the Lord to do them. This is called a tallit. The corner, four corners, is called a kanaf. And actually the Hebrew word kanaf is for the word wings. So a tallit has four wings and attached to those wings are these cords called tzitzit. Why did God do this? He said put, make tassels, put them on the corner to look and remember. Remember what? The commands of the Lord, to obey them, and to not follow after their own hearts. In other words, do life God's way, not your way. But why would this woman have ever thought to touch this? Where did that knowledge come from? Look at Malachi 4, verse 2. But for you who fear my name, the Son of Righteousness shall rise with healing in its wings. In its kanaf. And attached to the wing is a tzitzit. Healing in his wings. So it became a well-known legend that when Messiah came, there would be healing power in the tzitzit. But she came up from behind. Why do you think she came up from behind? She's a social misfit, and she's embarrassed, and she's afraid of the crowd and their reaction to her. But she risked all of that. The shame, the rejection from the crowd to get to Jesus. And what happens? Verse 29. And immediately, the flow of blood dried up, and she felt in her body that she was healed of her disease. So in those days, when something unclean touched clean, it became unclean. But here, something unclean touched clean and became clean. And Jesus, perceiving in himself that power had gone out from him, immediately turned about in the crowd and said, who touched my garments? Do you think Jesus knew who touched him? Of course he did. He was up to something. And he looked around to see who had done it, but the woman, knowing what had happened to her, came in fear and trembling and fell down before him and told him the truth. Why do you think Jesus probed so deep? I think he wanted her to tell the truth. For him, no. He knew the truth. It was for her to face 12 years of shame and mistreatment and misery and isolation, and in the face of God, to tell the truth. And I think at that moment, between the two of them, this woman and Jesus, it's like there's nobody else in the world. It's just the two of them. And I want you to know, that's how Jesus treats all of us. As if there's just us. See, I think sometimes we hear, you know, God so loved the world. We don't have a problem with God loving the world. Sometimes we just wonder, does God really love me? And the answer is, he loves you more than you'll ever know. He loves each of us as if there was only one of us to love. Verse 34, and he said to her, daughter, your faith has made you well. Go in peace and be healed of your disease. Mark saved the best part of this for last. Jesus says something to her he only says one other time in the New Testament. Three words. Go in peace. Now understand, the Bible was written in Greek, but it was primarily spoken in Hebrew. So the word that he would have used for go in peace in Hebrew is the word shalom. And shalom is the Hebrew word for complete. Shalom or peace is not just the absence of conflict or the absence of war. It is so much deeper than that. Shalom is the presence of the goodness of God. Shalom is to be complete, to lack nothing. Jewish theologian David Stern put it this way. He said, shalom is tranquility, safety, well-being, contentment, comfort, wholeness, and integrity. New Testament theologian Cornelius Plantinga puts it this way. Shalom is the way things ought to be. Question, when and where was their perfect shalom? The Garden of Eden. That's the original shalom, peace that God intended in the first place. So when Jesus says to this woman, go in peace, go in shalom, he's placing a blessing on all of her, not just her body that he healed, not just her soul that believed. Why? Because for Jesus, he doesn't just want to save our souls so we can go to heaven when we die. He wants to save all of you. He wants to save every part of your being. So he not only wants our souls to be saved, he wants our thoughts to be saved, our actions to be saved, our intentions to reflect the peace, the shalom, the contentment, the way things ought to be that is ours through this Messiah named Jesus. Think of it this way, in one sense salvation is a legal transaction. We're sinful and guilty of sin and because of our sin, our guilt, the judge, also known as God, has to deal with our sin because he's holy. Enter Jesus, who dies on the cross in our place to pay for all of that. Jesus gets what we deserve. So because of our trust in this Jesus, we have peace with God. But for Jesus it was far more than a legal exchange. To be saved for Jesus is to freely receive and be at peace with God, yes, but I believe that Jesus desires we enter a new way of life that represents and demonstrates the peace of God. You see the difference? Peace with God, Jesus did all that and we trust that. Peace of God, well that's maybe up to us. See, God isn't just interested in covering our sin, he did that, but God wants to make us into the kind of people we were originally created to be. He wants to restore not just us and our souls, but the whole world. How? Through radicals like us, who love, who forgive, who are generous, who are aware of God's presence, who are grateful, who are patient, who take breaks, who live for today, who tell the truth. Radicals like us who trust God and who live at peace and harmony with God now and forever, that's Shalom. Paul said this in Colossians chapter 1, for in him, Jesus, all the fullness of God was pleased to dwell and through him to reconcile to himself all things, whether on earth or in heaven, by making peace, Shalom, by the blood of his cross. What did Jesus say when his disciples asked him, Lord, how should we pray? He said, pray, thy kingdom come, thy will be done, on earth as it is in heaven. Pray that, then do that. That's Shalom. That's the way things ought to be. One of my favorite quotes is by Tim Hansel, and he wrote a book called, You Gotta Keep Dancing, and Tim put it this way: God has given us such immense freedom that he will allow us to be as miserable as we choose to be. It's possible to be saved and miserable. It's possible to be saved and not be a whole, peace-filled, life-giving person. God's desire is that salvation affect every part of us, not just where we go when we die. How many of you have ever told a lie? Any peace in telling a lie? No, because it's possible you will be found out. Where's the peace? Telling the truth. That's shalom. If you're generous, you know the peace that comes from knowing that all of your resources ultimately come from God. If you speed on the road, doing 84 mile an hour down I-75 and you see a cop, do you have peace? No. Drive the speed limit. You see a cop? Absolute peace. Driving the speed limit is a better way to live. If you worry, do you have peace? No. Look what Paul said in Philippians chapter 4. Do not be anxious about anything. But in everything, by prayer and supplication, with thanksgiving, let your requests be made known to God. And the peace of God, which surpasses all understanding, will guard your hearts and your minds in Christ Jesus. Here's what I think Jesus offered that woman that day. She believed Jesus was who he said he was. But Jesus' interaction with her did not stop there. He offered her something more than healing. He offered her peace. Shalom. Do you think this woman's life was ever the same? No. Her entire life changed. And I believe it can us too. I have a fear of missing out on the best that God has for me. I don't want to miss out on the peace, the shalom, that God has for me. Do you? Let's pray together. Heavenly Father we thank you that the cross is not just there to do something for us but also in us. Lord you said before you do this, take a minute and say where am I at here? Do I need to be loved by you? Do I need to be forgiven by you? The answer for all of us is absolutely. So Lord we come to you this morning and we confess we have messed up. We've not done the things we need to do. But you said that's okay. I love you anyway and I forgive you when you ask. Lord may we all leave this place this morning hearing your word and allow it to change us. In Jesus name we pray. Amen.
  assert:
    - type: javascript
      value: |
        // Check that summary doesn't start with imperative verb
        const json = typeof output === 'string' ? JSON.parse(output) : output;
        const summary = json.summary || '';
        const firstWord = summary.trim().split(/\s+/)[0].toLowerCase();
        const banned = ['stop', 'start', 'begin', 'let', 'take', 'make', 'do', "don't"];
        return !banned.includes(firstWord);
    - type: javascript
      value: |
        // Verify keyPoints array has at least 2 items
        const json = typeof output === 'string' ? JSON.parse(output) : output;
        return json.keyPoints && json.keyPoints.length >= 2;
    - type: javascript
      value: |
        // Check that mainScripture references Mark 5
        const json = typeof output === 'string' ? JSON.parse(output) : output;
        const scripture = (json.mainScripture || '').toLowerCase();
        return scripture.includes('mark') && scripture.includes('5');
    # ACCURACY VALIDATIONS
    - type: javascript
      value: |
        // Verify quotes appear in transcript (fuzzy match - at least 60% of words)
        const json = typeof output === 'string' ? JSON.parse(output) : output;
        const transcript = context.vars.transcript.toLowerCase();
        const quotes = json.quotes || [];
        if (quotes.length === 0) return true;

        function wordOverlap(quote, text) {
          const quoteWords = quote.toLowerCase().replace(/[^\w\s]/g, '').split(/\s+/).filter(w => w.length > 3);
          if (quoteWords.length === 0) return 1;
          const matchCount = quoteWords.filter(w => text.includes(w)).length;
          return matchCount / quoteWords.length;
        }

        const failed = quotes.filter(q => wordOverlap(q.text, transcript) < 0.6);
        return failed.length === 0;
    - type: javascript
      value: |
        // Verify scripture references were mentioned in transcript (with word-to-number normalization)
        const json = typeof output === 'string' ? JSON.parse(output) : output;
        const transcript = context.vars.transcript.toLowerCase();

        // Number word mappings
        const ordinals = {first:'1',second:'2',third:'3',fourth:'4',fifth:'5',sixth:'6',seventh:'7',eighth:'8',ninth:'9',tenth:'10',eleventh:'11',twelfth:'12',thirteenth:'13',fourteenth:'14',fifteenth:'15',sixteenth:'16',seventeenth:'17',eighteenth:'18',nineteenth:'19',twentieth:'20',twentyfirst:'21',twentysecond:'22',twentythird:'23',twentyfourth:'24',twentyfifth:'25',twentysixth:'26',twentyseventh:'27',twentyeighth:'28',twentyninth:'29',thirtieth:'30',thirtyfirst:'31'};
        const cardinals = {one:'1',two:'2',three:'3',four:'4',five:'5',six:'6',seven:'7',eight:'8',nine:'9',ten:'10',eleven:'11',twelve:'12',thirteen:'13',fourteen:'14',fifteen:'15',sixteen:'16',seventeen:'17',eighteen:'18',nineteen:'19',twenty:'20',twentyone:'21',twentytwo:'22',twentythree:'23',twentyfour:'24',twentyfive:'25',twentysix:'26',twentyseven:'27',twentyeight:'28',twentynine:'29',thirty:'30',thirtyone:'31',thirtytwo:'32',thirtythree:'33',thirtyfour:'34',thirtyfive:'35',thirtysix:'36',thirtyseven:'37',thirtyeight:'38',thirtynine:'39',forty:'40',fortyone:'41',fortytwo:'42',fortythree:'43',fortyfour:'44',fortyfive:'45',fortysix:'46',fortyseven:'47',fortyeight:'48',fortynine:'49',fifty:'50',fiftyone:'51',fiftytwo:'52',fiftythree:'53',fiftyfour:'54',fiftyfive:'55',fiftysix:'56',fiftyseven:'57',fiftyeight:'58',fiftynine:'59',sixty:'60',sixtyone:'61',sixtytwo:'62',sixtythree:'63',sixtyfour:'64',sixtyfive:'65',sixtysix:'66',sixtyseven:'67',sixtyeight:'68',sixtynine:'69',seventy:'70',seventyone:'71',seventytwo:'72',seventythree:'73',seventyfour:'74',seventyfive:'75',seventysix:'76',seventyseven:'77',seventyeight:'78',seventynine:'79',eighty:'80',eightyone:'81',eightytwo:'82',eightythree:'83',eightyfour:'84',eightyfive:'85',eightysix:'86',eightyseven:'87',eightyeight:'88',eightynine:'89',ninety:'90',ninetyone:'91',ninetytwo:'92',ninetythree:'93',ninetyfour:'94',ninetyfive:'95',ninetysix:'96',ninetyseven:'97',ninetyeight:'98',ninetynine:'99',onehundred:'100',hundred:'100'};
        const books = ['genesis','exodus','leviticus','numbers','deuteronomy','joshua','judges','ruth','samuel','kings','chronicles','ezra','nehemiah','esther','job','psalm','psalms','proverbs','ecclesiastes','song of solomon','isaiah','jeremiah','lamentations','ezekiel','daniel','hosea','joel','amos','obadiah','jonah','micah','nahum','habakkuk','zephaniah','haggai','zechariah','malachi','matthew','mark','luke','john','acts','romans','corinthians','galatians','ephesians','philippians','colossians','thessalonians','timothy','titus','philemon','hebrews','james','peter','jude','revelation'];

        function normalize(text) {
          let t = text.toLowerCase().replace(/[-]/g, ' ');
          // Ordinals for book prefixes (first john -> 1 john)
          for (const [word, num] of Object.entries(ordinals)) {
            t = t.replace(new RegExp('\\b' + word + '\\b', 'g'), num);
          }
          // Cardinals for chapters/verses
          for (const [word, num] of Object.entries(cardinals)) {
            t = t.replace(new RegExp('\\b' + word + '\\b', 'g'), num);
          }
          return t;
        }

        const normTranscript = normalize(transcript);
        const scriptures = [];
        if (json.mainScripture) scriptures.push(json.mainScripture);
        (json.keyPoints || []).forEach(kp => { if (kp.scripture) scriptures.push(kp.scripture); });

        const failed = scriptures.filter(ref => {
          if (!ref || ref.trim() === '') return false;
          const normRef = normalize(ref);
          const bookMatch = normRef.match(/^(\d?\s*[a-z]+)/);
          if (!bookMatch) return false;
          const book = bookMatch[1].replace(/\s+/g, ' ').trim();
          return !normTranscript.includes(book);
        });

        return failed.length === 0;
